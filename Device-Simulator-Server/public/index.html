<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSLABå®éªŒå®¤ç¯å¢ƒæ§åˆ¶ç³»ç»Ÿ - ä¸»æ§å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        .device-status-online {
            color: #28a745;
        }
        .device-status-offline {
            color: #dc3545;
        }
        .device-status-connecting {
            color: #ffc107;
        }
        .group-badge {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <!-- ç»Ÿä¸€å¯¼èˆªæ å®¹å™¨ -->
    <div id="navbar-container"></div>

    <div class="container">
        <!-- æ¬¢è¿æ ‡é¢˜ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="text-center">
                    <h2 class="mb-2">ğŸ¢ SSLABå®éªŒå®¤ç¯å¢ƒæ§åˆ¶ç³»ç»Ÿ</h2>
                    <p class="text-muted">æ™ºèƒ½ç¡¬ä»¶è®¾å¤‡æ¨¡æ‹Ÿå™¨ç®¡ç†å¹³å° - ç³»ç»Ÿæ¦‚è§ˆ</p>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="bi bi-hdd-stack display-4"></i>
                        <h3 id="totalDevices" class="mt-2">0</h3>
                        <p class="mb-0">æ€»è®¾å¤‡æ•°</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="bi bi-check-circle display-4"></i>
                        <h3 id="onlineDevices" class="mt-2">0</h3>
                        <p class="mb-0">åœ¨çº¿è®¾å¤‡</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="bi bi-collection display-4"></i>
                        <h3 id="totalGroups" class="mt-2">0</h3>
                        <p class="mb-0">è®¾å¤‡åˆ†ç»„</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="bi bi-people display-4"></i>
                        <h3 id="connectedClients" class="mt-2">0</h3>
                        <p class="mb-0">è¿æ¥å®¢æˆ·ç«¯</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h6><i class="bi bi-wifi"></i> è¿æ¥çŠ¶æ€</h6>
                        <span id="connectionStatus" class="badge bg-warning">è¿æ¥ä¸­...</span>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h6><i class="bi bi-activity"></i> ç³»ç»Ÿå¥åº·</h6>
                        <div id="systemHealthContainer">
                            <span class="text-muted">è·å–ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¿«é€Ÿæ“ä½œé¢æ¿ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-lightning"></i> å¿«é€Ÿæ“ä½œ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6>è®¾å¤‡æ§åˆ¶</h6>
                                <div class="btn-group-vertical w-100" role="group">
                                    <button type="button" class="btn btn-outline-success" onclick="controlAllDevices('turnOn')">
                                        <i class="bi bi-power"></i> å…¨éƒ¨å¼€å¯
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" onclick="controlAllDevices('turnOff')">
                                        <i class="bi bi-stop"></i> å…¨éƒ¨å…³é—­
                                    </button>
                                    <button type="button" class="btn btn-outline-warning" onclick="controlAllDevices('toggle')">
                                        <i class="bi bi-arrow-repeat"></i> å…¨éƒ¨åˆ‡æ¢
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6>ç³»ç»Ÿç®¡ç†</h6>
                                <div class="btn-group-vertical w-100" role="group">
                                    <button type="button" class="btn btn-outline-info" onclick="refreshData()">
                                        <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°æ•°æ®
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="resetSystem()">
                                        <i class="bi bi-bootstrap-reboot"></i> é‡ç½®ç³»ç»Ÿ
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" onclick="clearAllDevices()">
                                        <i class="bi bi-trash"></i> æ¸…ç©ºè®¾å¤‡
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6>SSLABè®¾å¤‡å¿«é€Ÿæ·»åŠ </h6>
                                <div class="btn-group-vertical w-100" role="group">
                                    <button type="button" class="btn btn-outline-primary" onclick="addQuickDevice('ENVIRONMENT_MONITOR')">
                                        <i class="bi bi-thermometer-half"></i> ç¯å¢ƒç›‘æµ‹è£…ç½®
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="addQuickDevice('STUDENT_POWER_TERMINAL')">
                                        <i class="bi bi-power"></i> å­¦ç”Ÿç”µæºç»ˆç«¯
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="addQuickDevice('ENVIRONMENT_CONTROLLER')">
                                        <i class="bi bi-wind"></i> ç¯å¢ƒæ§åˆ¶å™¨
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="addQuickDevice('CURTAIN_CONTROLLER')">
                                        <i class="bi bi-window"></i> çª—å¸˜æ§åˆ¶å™¨
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="addQuickDevice('LIGHTING_CONTROLLER')">
                                        <i class="bi bi-lightbulb"></i> ç¯å…‰æ§åˆ¶å™¨
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="addQuickDevice('LIFT_CONTROLLER')">
                                        <i class="bi bi-arrow-up-down"></i> å‡é™æ§åˆ¶å™¨
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆ†ç»„çŠ¶æ€æ¦‚è§ˆ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-diagram-3"></i> åˆ†ç»„çŠ¶æ€æ¦‚è§ˆ</h5>
                    </div>
                    <div class="card-body">
                        <div id="groupsOverview" class="row">
                            <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç»„å¡ç‰‡ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿä¿¡æ¯ -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-speedometer2"></i> ç³»ç»Ÿä¿¡æ¯</h5>
                    </div>
                    <div class="card-body">
                        <div id="systemInfo">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <h6 class="text-primary">ğŸ¢ SSLABå®éªŒå®¤ç¯å¢ƒæ§åˆ¶ç³»ç»Ÿ</h6>
                                    <small class="text-muted">æ™ºèƒ½ç¡¬ä»¶è®¾å¤‡æ¨¡æ‹Ÿå™¨å¹³å°</small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">æœåŠ¡å™¨è¿è¡Œæ—¶é—´</small>
                                    <div id="serverUptime">--</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">å†…å­˜ä½¿ç”¨</small>
                                    <div id="memoryUsage">--</div>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">æ”¯æŒè®¾å¤‡ç±»å‹</small>
                                    <div class="small">6ç§SSLABè®¾å¤‡</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">å®æ—¶é€šä¿¡</small>
                                    <div class="small">WebSocket + REST API</div>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-12">
                                    <small class="text-muted">å¹³å°åŠŸèƒ½</small>
                                    <div class="small">
                                        âœ… è®¾å¤‡ç®¡ç† â€¢ âœ… åˆ†ç»„ç®¡ç† â€¢ âœ… å®æ—¶ç›‘æ§ â€¢ âœ… ç³»ç»Ÿç®¡ç†
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ´»åŠ¨æ—¥å¿— -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-journal-text"></i> æ´»åŠ¨æ—¥å¿—</h5>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity">
                            <p class="text-muted">æš‚æ— æ´»åŠ¨è®°å½•</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        // Socket.IOè¿æ¥
        const socket = io();
        const activityLog = [];

        // è¿æ¥çŠ¶æ€ç®¡ç†
        socket.on('connect', () => {
            document.getElementById('connectionStatus').textContent = 'å·²è¿æ¥';
            document.getElementById('connectionStatus').className = 'badge bg-success';
            addActivity('ç³»ç»Ÿè¿æ¥æˆåŠŸ', 'success');
        });

        socket.on('disconnect', () => {
            document.getElementById('connectionStatus').textContent = 'å·²æ–­å¼€';
            document.getElementById('connectionStatus').className = 'badge bg-danger';
            addActivity('ç³»ç»Ÿè¿æ¥æ–­å¼€', 'danger');
        });

        // æ¥æ”¶ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
        socket.on('stats:update', (stats) => {
            console.log('æ”¶åˆ°ç»Ÿè®¡æ•°æ®:', stats); // è°ƒè¯•æ—¥å¿—
            updateStats(stats);
        });

        // æ¥æ”¶è®¾å¤‡åˆ—è¡¨
        socket.on('devices:list', (devices) => {
            console.log('æ”¶åˆ°è®¾å¤‡åˆ—è¡¨:', devices); // è°ƒè¯•æ—¥å¿—
            // ä¸»é¡µåªæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œè¯¦ç»†è®¾å¤‡åˆ—è¡¨åœ¨è®¾å¤‡ç®¡ç†é¡µé¢
        });

        // æ¥æ”¶åˆ†ç»„åˆ—è¡¨
        socket.on('groups:list', (groups) => {
            console.log('æ”¶åˆ°åˆ†ç»„åˆ—è¡¨:', groups); // è°ƒè¯•æ—¥å¿—
            updateGroupsOverview(groups);
        });

        // æ¥æ”¶åˆ†ç»„åˆ—è¡¨
        socket.on('groups:list', (groups) => {
            updateGroupsOverview(groups);
        });

        // æ¥æ”¶è¿æ¥ä¿¡æ¯
        socket.on('connection:info', (info) => {
            document.getElementById('connectedClients').textContent = info.connectedClients;
        });

        // è®¾å¤‡äº‹ä»¶ç›‘å¬
        socket.on('device:deviceAdded', (device) => {
            addActivity(`è®¾å¤‡å·²æ·»åŠ : ${device.name}`, 'info');
        });

        socket.on('device:deviceRemoved', (device) => {
            addActivity(`è®¾å¤‡å·²ç§»é™¤: ${device.name}`, 'warning');
        });

        socket.on('device:deviceControlled', (data) => {
            addActivity(`è®¾å¤‡æ§åˆ¶: ${data.result.name} - ${data.command}`, 'primary');
        });

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(stats) {
            console.log('æ”¶åˆ°ç»Ÿè®¡æ•°æ®:', stats); // è°ƒè¯•æ—¥å¿—
            
            if (stats) {
                // æ›´æ–°æ€»è®¾å¤‡æ•°
                const totalDevicesEl = document.getElementById('totalDevices');
                if (totalDevicesEl) {
                    totalDevicesEl.textContent = stats.total || 0;
                }
                
                // æ›´æ–°åœ¨çº¿è®¾å¤‡æ•°
                const onlineDevicesEl = document.getElementById('onlineDevices');
                if (onlineDevicesEl) {
                    onlineDevicesEl.textContent = stats.online || 0;
                }
                
                // è®¡ç®—å¹¶æ›´æ–°åˆ†ç»„æ•°é‡
                const groupCount = stats.byGroup ? Object.keys(stats.byGroup).length : 0;
                const totalGroupsEl = document.getElementById('totalGroups');
                if (totalGroupsEl) {
                    totalGroupsEl.textContent = groupCount;
                }
                
                console.log('ç»Ÿè®¡æ•°æ®å·²æ›´æ–°:', { 
                    total: stats.total, 
                    online: stats.online, 
                    groups: groupCount 
                });
            } else {
                console.warn('æ”¶åˆ°ç©ºçš„ç»Ÿè®¡æ•°æ®');
            }
        }

        // æ›´æ–°åˆ†ç»„æ¦‚è§ˆ
        function updateGroupsOverview(groups) {
            const container = document.getElementById('groupsOverview');
            container.innerHTML = '';
            
            if (groups.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-muted">æš‚æ— åˆ†ç»„</p></div>';
                return;
            }
            
            groups.forEach(group => {
                const groupCard = `
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <span class="group-badge">${group.groupId}</span>
                                    ${group.name}
                                </h6>
                                <p class="card-text text-muted">${group.description || 'æš‚æ— æè¿°'}</p>
                                <div class="row text-center">
                                    <div class="col-4">
                                        <small class="text-muted">æ¥¼æ ‹</small>
                                        <div>${group.building}</div>
                                    </div>
                                    <div class="col-4">
                                        <small class="text-muted">æ¥¼å±‚</small>
                                        <div>${group.floor}å±‚</div>
                                    </div>
                                    <div class="col-4">
                                        <small class="text-muted">æˆ¿é—´</small>
                                        <div>${group.room}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += groupCard;
            });
        }

        // æ·»åŠ æ´»åŠ¨æ—¥å¿—
        function addActivity(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const activity = {
                message,
                type,
                timestamp
            };
            
            activityLog.unshift(activity);
            if (activityLog.length > 50) {
                activityLog.splice(50);
            }
            
            updateActivityDisplay();
        }

        // æ›´æ–°æ´»åŠ¨æ˜¾ç¤º
        function updateActivityDisplay() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '';
            
            if (activityLog.length === 0) {
                container.innerHTML = '<p class="text-muted">æš‚æ— æ´»åŠ¨è®°å½•</p>';
                return;
            }
            
            activityLog.slice(0, 10).forEach(activity => {
                const item = `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="badge bg-${activity.type} me-2">${activity.type}</span>
                        <span class="flex-grow-1">${activity.message}</span>
                        <small class="text-muted">${activity.timestamp}</small>
                    </div>
                `;
                container.innerHTML += item;
            });
        }

        // æ§åˆ¶æ‰€æœ‰è®¾å¤‡
        function controlAllDevices(command) {
            socket.emit('devices:get');
            socket.once('devices:list', (devices) => {
                if (devices.length === 0) {
                    alert('æ²¡æœ‰å¯æ§åˆ¶çš„è®¾å¤‡');
                    return;
                }
                
                const deviceIds = devices.map(d => d.id);
                socket.emit('devices:control:batch', {
                    deviceIds,
                    command
                });
                
                addActivity(`æ‰¹é‡${command === 'turnOn' ? 'å¼€å¯' : command === 'turnOff' ? 'å…³é—­' : 'åˆ‡æ¢'}è®¾å¤‡ (${devices.length}å°)`, 'primary');
            });
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            console.log('å¼€å§‹åˆ·æ–°æ•°æ®...');
            
            // ä½¿ç”¨HTTP APIè·å–æ•°æ®ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
            Promise.all([
                fetch('/api/devices/stats').then(res => res.json()).then(data => data.success ? data.data : { total: 0, online: 0, byGroup: {} }),
                fetch('/api/groups').then(res => res.json()).then(data => data.success ? data.data : []),
                fetch('/api/system/health').then(res => res.json()).then(data => data.success ? data.data : { status: 'unknown', uptime: 0 })
            ]).then(([stats, groups, health]) => {
                console.log('åˆ·æ–°æ•°æ®å®Œæˆ:', { stats, groups, health });
                
                // æ›´æ–°ç•Œé¢
                updateStats(stats);
                updateGroupsOverview(groups);
                updateSystemStatus(health);
                
                addActivity('æ•°æ®å·²åˆ·æ–°', 'info');
            }).catch(error => {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
                addActivity('æ•°æ®åˆ·æ–°å¤±è´¥', 'danger');
            });
            
            // åŒæ—¶é€šè¿‡WebSocketè¯·æ±‚æ›´æ–°ï¼ˆåŒé‡ä¿é™©ï¼‰
            if (socket && socket.connected) {
                socket.emit('devices:get');
                socket.emit('groups:get');
                socket.emit('stats:get');
            }
        }
        
        // æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º
        function updateSystemStatus(health) {
            const container = document.getElementById('systemHealthContainer');
            if (container) {
                const statusText = health.status === 'healthy' ? 'æ­£å¸¸è¿è¡Œ' : 
                                 health.status === 'unknown' ? 'çŠ¶æ€æœªçŸ¥' : 'å¼‚å¸¸';
                const statusClass = health.status === 'healthy' ? 'text-success' : 
                                  health.status === 'unknown' ? 'text-warning' : 'text-danger';
                
                const uptimeHours = health.uptime ? Math.floor(health.uptime / 3600) : 0;
                const uptimeMinutes = health.uptime ? Math.floor((health.uptime % 3600) / 60) : 0;
                
                container.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <span>ç³»ç»ŸçŠ¶æ€: <span class="${statusClass}">${statusText}</span></span>
                        <small class="text-muted">è¿è¡Œæ—¶é—´: ${uptimeHours}å°æ—¶${uptimeMinutes}åˆ†é’Ÿ</small>
                    </div>
                `;
            }
        }

        // é‡ç½®ç³»ç»Ÿ
        function resetSystem() {
            if (confirm('ç¡®å®šè¦é‡ç½®ç³»ç»ŸçŠ¶æ€å—ï¼Ÿè¿™å°†é‡ç½®æ‰€æœ‰è®¾å¤‡çŠ¶æ€ã€‚')) {
                socket.emit('system:reset');
                addActivity('ç³»ç»Ÿå·²é‡ç½®', 'warning');
            }
        }

        // æ¸…ç©ºæ‰€æœ‰è®¾å¤‡
        function clearAllDevices() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®¾å¤‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                socket.emit('system:clear');
                addActivity('æ‰€æœ‰è®¾å¤‡å·²æ¸…ç©º', 'danger');
            }
        }

        // å¿«é€Ÿæ·»åŠ è®¾å¤‡
        function addQuickDevice(type) {
            const deviceNames = {
                'ENVIRONMENT_MONITOR': 'ç¯å¢ƒç›‘æµ‹è£…ç½®',
                'STUDENT_POWER_TERMINAL': 'å­¦ç”Ÿç”µæºç»ˆç«¯',
                'ENVIRONMENT_CONTROLLER': 'ç¯å¢ƒæ§åˆ¶å™¨',
                'CURTAIN_CONTROLLER': 'çª—å¸˜æ§åˆ¶å™¨',
                'LIGHTING_CONTROLLER': 'ç¯å…‰æ§åˆ¶å™¨',
                'LIFT_CONTROLLER': 'å‡é™æ§åˆ¶å™¨'
            };
            
            const deviceCount = Math.floor(Math.random() * 900) + 100;
            const deviceConfig = {
                name: `${deviceNames[type]}-${deviceCount}`,
                type: type,
                groupId: 'HX001' // é»˜è®¤åˆ†ç»„ï¼šæµ·å¿ƒæ¥¼101
            };
            
            socket.emit('device:add', deviceConfig);
            addActivity(`å¿«é€Ÿæ·»åŠ SSLABè®¾å¤‡: ${deviceConfig.name}`, 'success');
        }

        // è·å–ç³»ç»Ÿå¥åº·ä¿¡æ¯
        function getSystemHealth() {
            fetch('/api/system/health')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const health = data.data;
                        
                        // æ›´æ–°æœåŠ¡å™¨è¿è¡Œæ—¶é—´
                        document.getElementById('serverUptime').textContent = health.server.uptimeFormatted;
                        
                        // æ›´æ–°å†…å­˜ä½¿ç”¨ä¿¡æ¯ - æ˜¾ç¤ºç³»ç»Ÿå†…å­˜
                        const memoryText = `${health.memory.system.used}MB / ${health.memory.system.total}MB (${health.memory.system.usagePercent}%)`;
                        document.getElementById('memoryUsage').textContent = memoryText;
                        
                        // æ›´æ–°è¿æ¥å®¢æˆ·ç«¯æ•°
                        if (document.getElementById('connectedClients')) {
                            document.getElementById('connectedClients').textContent = health.application.connectedClients;
                        }
                        
                        // æ›´æ–°ç³»ç»Ÿå¥åº·çŠ¶æ€æ˜¾ç¤º
                        const healthContainer = document.getElementById('systemHealthContainer');
                        if (healthContainer) {
                            const statusClass = health.status === 'healthy' ? 'text-success' : 'text-danger';
                            const platformInfo = `${health.system.platform} ${health.system.architecture}`;
                            const cpuInfo = `${health.system.cpuCount}æ ¸ CPU`;
                            
                            healthContainer.innerHTML = `
                                <span class="${statusClass}">â— ${health.status}</span>
                                <br><small class="text-muted">${platformInfo} â€¢ ${cpuInfo}</small>
                            `;
                        }
                    }
                })
                .catch(error => {
                    console.error('è·å–ç³»ç»Ÿå¥åº·ä¿¡æ¯å¤±è´¥:', error);
                    // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                    const healthContainer = document.getElementById('systemHealthContainer');
                    if (healthContainer) {
                        healthContainer.innerHTML = '<span class="text-danger">â— è·å–å¤±è´¥</span>';
                    }
                });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // è¯·æ±‚åˆå§‹æ•°æ®
            refreshData();
            
            // å®šæœŸè·å–ç³»ç»Ÿå¥åº·ä¿¡æ¯
            getSystemHealth();
            setInterval(getSystemHealth, 30000);
            
            addActivity('ç³»ç»Ÿç•Œé¢å·²åŠ è½½', 'info');
        });
    </script>
    
    <!-- å¯¼èˆªæ ç»„ä»¶åŠ è½½å™¨ -->
    <script src="js/navbar.js"></script>
</body>
</html>
