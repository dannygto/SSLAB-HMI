<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统管理 - SSLAB设备模拟器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .system-logs-container {
            height: 400px;
            overflow-y: auto;
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            padding: 0;
            border-radius: 0.375rem;
            width: 100%;
            box-sizing: border-box;
        }
        .log-error {
            color: #f85149;
        }
        .log-warn {
            color: #f0ad4e;
        }
        .log-info {
            color: #79b8ff;
        }
        .log-success {
            color: #56d364;
        }
    </style>
</head>
<body>
    <!-- 统一导航栏容器 -->
    <div id="navbar-container"></div>

    <div class="container">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">⚙️ 系统设置</h5>
                        </div>
                        <div class="card-body">
                            <h6>服务器配置</h6>
                            <div class="mb-3">
                                <label class="form-label">服务器端口</label>
                                <input type="number" class="form-control" id="serverPort" value="8080" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">UDP发现端口</label>
                                <input type="number" class="form-control" id="udpPort" value="12345" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">设备数据更新间隔(秒)</label>
                                <input type="number" class="form-control" id="updateInterval" value="5" min="1" max="60">
                            </div>
                            <button class="btn btn-primary" onclick="updateSettings()">保存设置</button>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">📊 系统状态</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <h6>运行时间</h6>
                                    <p id="uptime" class="text-muted">计算中...</p>
                                </div>
                                <div class="col-6">
                                    <h6>内存使用</h6>
                                    <p id="memoryUsage" class="text-muted">计算中...</p>
                                </div>
                                <div class="col-6">
                                    <h6>连接客户端</h6>
                                    <p id="connectedClients" class="text-muted">0</p>
                                </div>
                                <div class="col-6">
                                    <h6>API调用次数</h6>
                                    <p id="apiCalls" class="text-muted">0</p>
                                </div>
                            </div>
                            <button class="btn btn-outline-primary" onclick="refreshSystemInfo()">刷新信息</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <!-- 系统日志区域 -->
                <div class="col-md-8">
                    <div class="card h-100">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">📋 系统日志</h6>
                                <div class="d-flex align-items-center">
                                    <select class="form-select form-select-sm me-2" id="logLevel" style="width: 100px;">
                                        <option value="all">全部</option>
                                        <option value="error">错误</option>
                                        <option value="warning">警告</option>
                                        <option value="info">信息</option>
                                        <option value="debug">调试</option>
                                    </select>
                                    <div class="form-check form-switch d-inline-block me-3">
                                        <input class="form-check-input" type="checkbox" id="autoScroll" checked>
                                        <label class="form-check-label" for="autoScroll">自动滚动</label>
                                    </div>
                                    <button class="btn btn-outline-danger btn-sm" onclick="clearLogs()">清空日志</button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="systemLogs" class="system-logs-container">
                                <!-- 系统日志内容 -->
                                <div class="text-muted py-3">
                                    系统日志将在这里显示...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右侧操作面板 -->
                <div class="col-md-4">
                    <div class="row">
                        <!-- 数据管理 -->
                        <div class="col-12 mb-3">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">📁 数据管理</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" onclick="createTestDevices()">
                                            <i class="bi bi-plus-circle"></i> 一键创建测试设备
                                        </button>
                                        <button class="btn btn-info" onclick="exportSystemData()">
                                            <i class="bi bi-download"></i> 导出系统数据
                                        </button>
                                        <input type="file" class="form-control" id="importFile" accept=".json">
                                        <button class="btn btn-primary" onclick="importSystemData()">
                                            <i class="bi bi-upload"></i> 导入系统数据
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 系统控制 -->
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">🛠️ 系统控制</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-info" onclick="showApiDocs()">
                                            <i class="bi bi-book"></i> 查看API文档
                                        </button>
                                        <button class="btn btn-warning" onclick="restartServer()">
                                            <i class="bi bi-arrow-clockwise"></i> 重启服务器
                                        </button>
                                        <button class="btn btn-secondary" onclick="enableMaintenanceMode()">
                                            <i class="bi bi-tools"></i> 维护模式
                                        </button>
                                        <button class="btn btn-danger" onclick="shutdownServer()">
                                            <i class="bi bi-power"></i> 关闭服务器
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let systemLogs = [];
        let startTime = Date.now();

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            refreshSystemInfo();
            refreshLogs();
            setupSocketListeners();
            
            // 定期更新系统信息
            setInterval(refreshSystemInfo, 10000);
        });

        // Socket事件监听
        function setupSocketListeners() {
            socket.on('systemLog', function(log) {
                systemLogs.unshift(log);
                if (systemLogs.length > 1000) {
                    systemLogs.pop();
                }
                updateLogsDisplay();
            });

            socket.on('systemStats', function(stats) {
                updateSystemStats(stats);
            });
        }

        // 更新系统设置
        function updateSettings() {
            const settings = {
                updateInterval: parseInt(document.getElementById('updateInterval').value)
            };

            // 这里可以发送设置到服务器
            // socket.emit('updateSettings', settings);
            
            alert('设置已保存（演示功能）');
        }

        // 刷新系统信息
        function refreshSystemInfo() {
            fetch('/api/system/health')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const health = data.data;
                        
                        // 更新运行时间
                        document.getElementById('uptime').textContent = health.server.uptimeFormatted;
                        
                        // 更新内存使用 (显示进程内存)
                        const processMemory = health.memory.process;
                        document.getElementById('memoryUsage').textContent = 
                            `${processMemory.rss}MB / ${health.memory.system.total}MB (进程: ${processMemory.heapUsed}MB堆内存)`;
                        
                        // 更新连接客户端数
                        document.getElementById('connectedClients').textContent = health.application.connectedClients;
                        
                        // 更新API调用次数
                        document.getElementById('apiCalls').textContent = health.application.apiCallsToday;
                        
                        addLog('info', `系统信息已更新 - 运行时间: ${health.server.uptimeFormatted}, 内存: ${processMemory.rss}MB`);
                    }
                })
                .catch(error => {
                    console.error('获取系统信息失败:', error);
                    addLog('error', '获取系统信息失败: ' + error.message);
                });
        }

        // 导出系统数据
        function exportSystemData() {
            Promise.all([
                fetch('/api/devices').then(r => r.json()),
                fetch('/api/groups').then(r => r.json())
            ]).then(([devicesResult, groupsResult]) => {
                const data = {
                    exportTime: new Date().toISOString(),
                    devices: devicesResult.success ? devicesResult.data : devicesResult,
                    groups: groupsResult.success ? groupsResult.data : groupsResult,
                    logs: systemLogs.slice(0, 100) // 最近100条日志
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sslab_system_data_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                addLog('info', '系统数据已导出');
            }).catch(error => {
                addLog('error', '导出系统数据失败: ' + error.message);
                alert('导出失败');
            });
        }

        // 导入系统数据
        function importSystemData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('请选择要导入的文件');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('导入数据将覆盖现有数据，确认继续吗？')) {
                        // 这里应该调用导入API
                        addLog('info', '系统数据导入功能待实现');
                        alert('导入功能待实现');
                    }
                } catch (error) {
                    addLog('error', '导入文件格式错误');
                    alert('文件格式错误');
                }
            };
            reader.readAsText(file);
        }

        // 一键创建测试设备
        async function createTestDevices() {
            if (!confirm('将创建100个测试设备和4个分组，这可能需要一些时间。确认继续吗？')) {
                return;
            }
            
            const button = document.querySelector('button[onclick="createTestDevices()"]');
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<i class="bi bi-hourglass-split"></i> 正在创建...';
            
            try {
                addLog('info', '开始批量创建测试设备...');
                
                const response = await fetch('/api/system/create-test-devices', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        deviceCount: 100,
                        groupCount: 4
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog('success', result.message);
                    alert(`测试设备创建成功！\n设备数量: ${result.data.devices}\n分组数量: ${result.data.groups}`);
                    
                    // 可选：刷新页面或更新相关信息
                    refreshSystemInfo();
                } else {
                    addLog('error', '创建测试设备失败: ' + result.error);
                    alert('创建失败: ' + result.error);
                }
                
            } catch (error) {
                addLog('error', '创建测试设备出错: ' + error.message);
                alert('操作失败: ' + error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        }

        // 刷新日志
        function refreshLogs() {
            // 生成一些示例日志
            const levels = ['info', 'warning', 'error'];
            const messages = [
                '设备状态更新完成',
                '客户端连接',
                '设备控制指令',
                'UDP广播发送',
                'WebSocket连接建立',
                '系统健康检查'
            ];
            
            for (let i = 0; i < 10; i++) {
                const level = levels[Math.floor(Math.random() * levels.length)];
                const message = messages[Math.floor(Math.random() * messages.length)];
                addLog(level, message);
            }
        }

        // 添加日志
        function addLog(level, message) {
            const log = {
                timestamp: new Date().toLocaleString(),
                level: level,
                message: message
            };
            
            systemLogs.unshift(log);
            if (systemLogs.length > 1000) {
                systemLogs.pop();
            }
            
            updateLogsDisplay();
        }

        // 更新日志显示
        function updateLogsDisplay() {
            const selectedLevel = document.getElementById('logLevel').value;
            const filteredLogs = selectedLevel === 'all' 
                ? systemLogs 
                : systemLogs.filter(log => log.level === selectedLevel);
            
            const logsContainer = document.getElementById('systemLogs');
            logsContainer.innerHTML = '';
            
            if (filteredLogs.length === 0) {
                logsContainer.innerHTML = '<div class="text-muted text-start">暂无日志记录</div>';
                return;
            }
            
            filteredLogs.slice(0, 50).forEach(log => {
                const logEntry = document.createElement('div');
                // 直接设置样式，不使用 Bootstrap 类
                logEntry.style.cssText = `
                    margin: 0;
                    padding: 0.25rem 1rem;
                    width: 100%;
                    box-sizing: border-box;
                    display: block;
                    background-color: #1e1e1e;
                    border: none;
                `;
                
                const levelColor = {
                    info: '#0dcaf0',     // text-info color
                    warning: '#ffc107',  // text-warning color 
                    error: '#dc3545'     // text-danger color
                }[log.level] || '#f8f9fa'; // text-light color
                
                logEntry.innerHTML = `
                    <span style="color: #6c757d;">[${log.timestamp}]</span> 
                    <span style="color: ${levelColor};">[${log.level.toUpperCase()}]</span> 
                    <span style="color: #f8f9fa;">${log.message}</span>
                `;
                
                logsContainer.appendChild(logEntry);
            });
        }

        // 清空日志
        function clearLogs() {
            if (confirm('确认要清空所有日志吗？')) {
                systemLogs = [];
                updateLogsDisplay();
                addLog('info', '日志已清空');
            }
        }

        // 下载日志
        function downloadLogs() {
            const selectedLevel = document.getElementById('logLevel').value;
            const filteredLogs = selectedLevel === 'all' 
                ? systemLogs 
                : systemLogs.filter(log => log.level === selectedLevel);
            
            const logText = filteredLogs.map(log => 
                `[${log.timestamp}] [${log.level.toUpperCase()}] ${log.message}`
            ).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sslab_logs_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            addLog('info', '日志文件已下载');
        }

        // 显示添加设备模态框
        async function showAddDeviceModal() {
            try {
                // 加载设备类型
                const response = await fetch('/api/info/device-types');
                const result = await response.json();
                
                if (result.success) {
                    const select = document.getElementById('deviceType');
                    select.innerHTML = '<option value="">请选择设备类型</option>';
                    
                    result.data.forEach(type => {
                        const option = document.createElement('option');
                        option.value = type.type;
                        option.textContent = `${type.name} (${type.model})`;
                        option.dataset.description = type.description;
                        select.appendChild(option);
                    });
                }
                
                // 加载分组信息
                const groupResponse = await fetch('/api/groups');
                const groupResult = await groupResponse.json();
                
                if (groupResult.success) {
                    const groupSelect = document.getElementById('deviceGroup');
                    groupSelect.innerHTML = '<option value="">无分组</option>';
                    
                    const groups = Array.isArray(groupResult.data) ? groupResult.data : Object.values(groupResult.data);
                    groups.forEach(group => {
                        const option = document.createElement('option');
                        option.value = group.groupId || group.id;
                        option.textContent = group.name;
                        groupSelect.appendChild(option);
                    });
                }
                
                // 设置事件监听
                document.getElementById('deviceType').addEventListener('change', updateDevicePreview);
                
                new bootstrap.Modal(document.getElementById('addDeviceModal')).show();
            } catch (error) {
                addLog('error', '加载设备类型失败: ' + error.message);
                alert('加载设备类型失败');
            }
        }

        // 更新设备预览信息
        async function updateDevicePreview() {
            const select = document.getElementById('deviceType');
            const selectedType = select.value;
            const preview = document.getElementById('devicePreview');
            const typeInfo = document.getElementById('deviceTypeInfo');
            
            if (!selectedType) {
                preview.innerHTML = '<small class="text-muted">请选择设备类型查看详细信息</small>';
                typeInfo.textContent = '';
                return;
            }
            
            const selectedOption = select.options[select.selectedIndex];
            typeInfo.textContent = selectedOption.dataset.description;
            
            try {
                const response = await fetch(`/api/info/device-capabilities/${selectedType}`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    preview.innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <strong>设备型号：</strong> ${data.model}<br>
                                <strong>设备类型：</strong> ${data.name}<br>
                                <strong>支持功能：</strong><br>
                                <ul class="mb-0 small">
                                    ${data.capabilities.map(cap => `<li>${cap}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <strong>支持命令：</strong><br>
                                <ul class="mb-0 small">
                                    ${data.commands.map(cmd => `<li><code>${cmd.command}</code> - ${cmd.description}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                } else {
                    preview.innerHTML = '<small class="text-danger">加载设备信息失败</small>';
                }
            } catch (error) {
                preview.innerHTML = '<small class="text-danger">加载设备信息出错</small>';
            }
        }

        // 创建设备
        async function createDevice() {
            const form = document.getElementById('addDeviceForm');
            const formData = new FormData(form);
            
            const deviceName = document.getElementById('deviceName').value.trim();
            const deviceType = document.getElementById('deviceType').value;
            const deviceGroup = document.getElementById('deviceGroup').value;
            const autoStart = document.getElementById('autoStart').checked;
            
            if (!deviceName) {
                alert('请输入设备名称');
                return;
            }
            
            if (!deviceType) {
                alert('请选择设备类型');
                return;
            }
            
            try {
                const deviceData = {
                    name: deviceName,
                    type: deviceType,
                    groupId: deviceGroup || null
                };
                
                const response = await fetch('/api/devices', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(deviceData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog('info', `成功创建设备: ${deviceName} (${deviceType})`);
                    
                    // 如果选择自动启动，则启动设备
                    if (autoStart && !result.data.enabled) {
                        try {
                            await fetch(`/api/devices/${result.data.id}/control`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ command: 'turnOn' })
                            });
                            addLog('info', `设备 ${deviceName} 已自动启动`);
                        } catch (startError) {
                            addLog('warning', `设备创建成功，但启动失败: ${startError.message}`);
                        }
                    }
                    
                    // 关闭模态框
                    bootstrap.Modal.getInstance(document.getElementById('addDeviceModal')).hide();
                    
                    // 清空表单
                    form.reset();
                    document.getElementById('devicePreview').innerHTML = '<small class="text-muted">请选择设备类型查看详细信息</small>';
                    document.getElementById('deviceTypeInfo').textContent = '';
                    
                    alert(`设备 "${deviceName}" 创建成功！`);
                } else {
                    addLog('error', `创建设备失败: ${result.error}`);
                    alert(`创建设备失败: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `创建设备出错: ${error.message}`);
                alert(`创建设备出错: ${error.message}`);
            }
        }

        // 显示API文档
        async function showApiDocs() {
            try {
                const modal = new bootstrap.Modal(document.getElementById('apiDocsModal'));
                modal.show();
                
                const response = await fetch('/api/info/api-docs');
                const docs = await response.json();
                
                const content = document.getElementById('apiDocsContent');
                content.innerHTML = `
                    <div class="row">
                        <div class="col-12">
                            <h4>${docs.title}</h4>
                            <p class="text-muted">${docs.description}</p>
                            <p><strong>基础URL:</strong> <code>${docs.baseUrl}</code></p>
                            <hr>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <h5>设备管理接口</h5>
                            ${Object.entries(docs.endpoints.devices).map(([endpoint, info]) => `
                                <div class="card mb-2">
                                    <div class="card-body p-2">
                                        <h6 class="card-title mb-1"><code>${endpoint}</code></h6>
                                        <p class="card-text small mb-1">${info.description}</p>
                                        ${info.body ? `<small class="text-muted">请求体: ${JSON.stringify(info.body)}</small>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="col-md-4">
                            <h5>分组管理接口</h5>
                            ${Object.entries(docs.endpoints.groups).map(([endpoint, info]) => `
                                <div class="card mb-2">
                                    <div class="card-body p-2">
                                        <h6 class="card-title mb-1"><code>${endpoint}</code></h6>
                                        <p class="card-text small mb-1">${info.description}</p>
                                        ${info.body ? `<small class="text-muted">请求体: ${JSON.stringify(info.body)}</small>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                            
                            <h5 class="mt-3">信息查询接口</h5>
                            ${Object.entries(docs.endpoints.info).map(([endpoint, info]) => `
                                <div class="card mb-2">
                                    <div class="card-body p-2">
                                        <h6 class="card-title mb-1"><code>${endpoint}</code></h6>
                                        <p class="card-text small mb-1">${info.description}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="col-md-4">
                            <h5>系统管理接口</h5>
                            ${docs.endpoints.system ? Object.entries(docs.endpoints.system).map(([endpoint, info]) => `
                                <div class="card mb-2">
                                    <div class="card-body p-2">
                                        <h6 class="card-title mb-1"><code>${endpoint}</code></h6>
                                        <p class="card-text small mb-1">${info.description}</p>
                                        ${info.body ? `<small class="text-muted">请求体: ${JSON.stringify(info.body)}</small>` : ''}
                                    </div>
                                </div>
                            `).join('') : ''}
                            
                            <h5 class="mt-3">统计信息接口</h5>
                            ${docs.endpoints.stats ? Object.entries(docs.endpoints.stats).map(([endpoint, info]) => `
                                <div class="card mb-2">
                                    <div class="card-body p-2">
                                        <h6 class="card-title mb-1"><code>${endpoint}</code></h6>
                                        <p class="card-text small mb-1">${info.description}</p>
                                    </div>
                                </div>
                            `).join('') : ''}
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h5>请求示例</h5>
                            ${Object.entries(docs.examples).map(([name, example]) => `
                                <div class="card mb-2">
                                    <div class="card-header py-2">
                                        <h6 class="mb-0">${name}</h6>
                                    </div>
                                    <div class="card-body p-2">
                                        <pre class="mb-1"><code>${example.url}</code></pre>
                                        ${example.body ? `<pre class="mb-0"><code>${JSON.stringify(example.body, null, 2)}</code></pre>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('apiDocsContent').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>加载API文档失败:</strong> ${error.message}
                    </div>
                `;
            }
        }

        // 服务器控制功能（演示用）
        function restartServer() {
            if (confirm('确认要重启服务器吗？')) {
                addLog('warning', '服务器重启功能待实现');
                alert('重启功能待实现');
            }
        }

        function enableMaintenanceMode() {
            addLog('info', '维护模式功能待实现');
            alert('维护模式功能待实现');
        }

        function shutdownServer() {
            if (confirm('确认要关闭服务器吗？这将断开所有连接。')) {
                addLog('error', '服务器关闭功能待实现');
                alert('关闭功能待实现');
            }
        }

        // 日志级别过滤
        document.getElementById('logLevel').addEventListener('change', updateLogsDisplay);
    </script>

    <style>
        .system-logs {
            height: 400px;
            overflow-y: auto;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .system-logs::-webkit-scrollbar {
            width: 8px;
        }

        .system-logs::-webkit-scrollbar-track {
            background: #343a40;
        }

        .system-logs::-webkit-scrollbar-thumb {
            background: #6c757d;
            border-radius: 4px;
        }

        .system-logs::-webkit-scrollbar-thumb:hover {
            background: #5a6268;
        }
    </style>

    <!-- 添加设备模态框 -->
    <div class="modal fade" id="addDeviceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">添加新设备</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addDeviceForm">
                        <div class="mb-3">
                            <label for="deviceName" class="form-label">设备名称 *</label>
                            <input type="text" class="form-control" id="deviceName" required 
                                   placeholder="例如：客厅智能开关">
                        </div>
                        <div class="mb-3">
                            <label for="deviceType" class="form-label">设备类型 *</label>
                            <select class="form-select" id="deviceType" required>
                                <option value="">请选择设备类型</option>
                            </select>
                            <div class="form-text">
                                <small id="deviceTypeInfo" class="text-muted"></small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="deviceGroup" class="form-label">设备分组</label>
                            <select class="form-select" id="deviceGroup">
                                <option value="">无分组</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="autoStart" checked>
                                <label class="form-check-label" for="autoStart">
                                    创建后自动启动设备
                                </label>
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <strong>设备信息预览：</strong>
                            <div id="devicePreview" class="mt-2">
                                <small class="text-muted">请选择设备类型查看详细信息</small>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="createDevice()">创建设备</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API文档模态框 -->
    <div class="modal fade" id="apiDocsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">API接口文档</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="apiDocsContent">
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">加载中...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- 导航栏组件加载器 -->
    <script src="js/navbar.js"></script>
</body>
</html>
