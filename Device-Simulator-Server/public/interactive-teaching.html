<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’åŠ¨æ•™å­¦ç³»ç»Ÿ - APIæµ‹è¯•é¡µé¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .api-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #0d6efd;
        }
        .seat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 0 auto;
        }
        .seat {
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            font-weight: bold;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .seat-empty { background-color: #e9ecef; color: #6c757d; }
        .seat-occupied { background-color: #cfe2ff; color: #084298; border: 2px solid #6ea8fe; }
        .seat-answered { background-color: #d1ecf1; color: #055160; }
        .seat-correct { background-color: #d1e7dd; color: #0f5132; border: 2px solid #badbcc; }
        .seat-incorrect { background-color: #f8d7da; color: #842029; border: 2px solid #f5c2c7; }

        .response-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .test-button {
            margin: 5px;
        }

        .form-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <!-- ç»Ÿä¸€å¯¼èˆªæ å®¹å™¨ -->
    <div id="navbar-container"></div>

    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="text-center">
                    <h2 class="mb-2">ğŸ“š äº’åŠ¨æ•™å­¦ç³»ç»Ÿ - APIæµ‹è¯•</h2>
                    <p class="text-muted">åœ¨çº¿æµ‹è¯•äº’åŠ¨æ•™å­¦ç³»ç»Ÿçš„æ‰€æœ‰APIæ¥å£</p>
                </div>
            </div>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="api-section">
                    <h4><i class="bi bi-info-circle"></i> ç³»ç»ŸçŠ¶æ€</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">å½“å‰ä¼šè¯</h6>
                                    <div id="current-session">åŠ è½½ä¸­...</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">è®¾å¤‡ç»Ÿè®¡</h6>
                                    <div id="device-stats">åŠ è½½ä¸­...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº§ä½å¸ƒå±€å¯è§†åŒ– -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="api-section">
                    <h4><i class="bi bi-grid-3x3"></i> åº§ä½å¸ƒå±€ (A1-D4)</h4>
                    <div class="seat-grid" id="seat-grid">
                        <!-- åº§ä½å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-primary btn-sm test-button" onclick="refreshSeats()">
                            <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°åº§ä½çŠ¶æ€
                        </button>
                        <button class="btn btn-success btn-sm test-button ms-2" onclick="assignAllStudents()">
                            <i class="bi bi-person-plus"></i> ä¸€é”®åˆ†é…16ä¸ªå­¦ç”Ÿ
                        </button>
                        <button class="btn btn-warning btn-sm test-button ms-2" onclick="simulateAllAnswers()">
                            <i class="bi bi-check2-square"></i> ä¸€é”®æ¨¡æ‹Ÿç­”é¢˜
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¼šè¯ç®¡ç† -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="api-section">
                    <h4><i class="bi bi-play-circle"></i> ä¼šè¯ç®¡ç†</h4>
                    <div class="form-section">
                        <h6>åˆ›å»ºæ–°ä¼šè¯</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <input type="text" class="form-control" id="session-name" placeholder="ä¼šè¯åç§°" value="æµ‹è¯•ä¼šè¯">
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control" id="session-description" placeholder="ä¼šè¯æè¿°" value="APIæµ‹è¯•ä¼šè¯">
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-success" onclick="createSession()">
                                    <i class="bi bi-plus"></i> åˆ›å»ºä¼šè¯
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex flex-wrap">
                        <button class="btn btn-info test-button" onclick="getCurrentSession()">è·å–å½“å‰ä¼šè¯</button>
                        <button class="btn btn-warning test-button" onclick="endSession()">ç»“æŸä¼šè¯</button>
                        <button class="btn btn-secondary test-button" onclick="clearSessionData()">æ¸…é™¤ä¼šè¯æ•°æ®</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¢˜ç›®ç®¡ç† -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="api-section">
                    <h4><i class="bi bi-question-circle"></i> é¢˜ç›®ç®¡ç†</h4>
                    <div class="form-section">
                        <h6>åˆ›å»ºæ–°é¢˜ç›®</h6>
                        <div class="row mb-2">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="question-text" placeholder="é¢˜ç›®å†…å®¹" value="1+1ç­‰äºå‡ ï¼Ÿ">
                            </div>
                            <div class="col-md-6">
                                <select class="form-control" id="question-type">
                                    <option value="single">å•é€‰é¢˜</option>
                                    <option value="multiple">å¤šé€‰é¢˜</option>
                                    <option value="text">æ–‡æœ¬é¢˜</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="option-a" placeholder="é€‰é¡¹A" value="1">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="option-b" placeholder="é€‰é¡¹B" value="2">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="option-c" placeholder="é€‰é¡¹C" value="3">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="option-d" placeholder="é€‰é¡¹D" value="4">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <input type="text" class="form-control" id="correct-answer" placeholder="æ­£ç¡®ç­”æ¡ˆ" value="B">
                            </div>
                            <div class="col-md-4">
                                <input type="number" class="form-control" id="time-limit" placeholder="æ—¶é—´é™åˆ¶(ç§’)" value="60">
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-success" onclick="createQuestion()">
                                    <i class="bi bi-plus"></i> åˆ›å»ºé¢˜ç›®
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex flex-wrap">
                        <button class="btn btn-primary test-button" onclick="publishQuestion()">å‘å¸ƒé¢˜ç›®</button>
                        <button class="btn btn-info test-button" onclick="getCurrentQuestion()">è·å–å½“å‰é¢˜ç›®</button>
                        <button class="btn btn-warning test-button" onclick="stopQuestion()">åœæ­¢ç­”é¢˜</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å­¦ç”Ÿç®¡ç† -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="api-section">
                    <h4><i class="bi bi-people"></i> å­¦ç”Ÿç®¡ç†</h4>
                    <div class="form-section">
                        <h6>åˆ†é…å­¦ç”Ÿåˆ°åº§ä½</h6>
                        <div class="row">
                            <div class="col-md-3">
                                <select class="form-control" id="seat-id">
                                    <option value="">é€‰æ‹©åº§ä½</option>
                                    <option value="A1">A1</option>
                                    <option value="A2">A2</option>
                                    <option value="B1">B1</option>
                                    <option value="C1">C1</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="student-id" placeholder="å­¦ç”ŸID" value="STU001">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="student-name" placeholder="å­¦ç”Ÿå§“å" value="å¼ ä¸‰">
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-success" onclick="assignStudent()">
                                    <i class="bi bi-person-plus"></i> åˆ†é…å­¦ç”Ÿ
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <h6>æ¨¡æ‹Ÿå­¦ç”Ÿç­”é¢˜</h6>
                        <div class="row">
                            <div class="col-md-3">
                                <select class="form-control" id="answer-seat-id">
                                    <option value="">é€‰æ‹©åº§ä½</option>
                                    <option value="A1">A1</option>
                                    <option value="A2">A2</option>
                                    <option value="B1">B1</option>
                                    <option value="C1">C1</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="answer-content" placeholder="ç­”æ¡ˆå†…å®¹" value="B">
                            </div>
                            <div class="col-md-3">
                                <input type="number" class="form-control" id="answer-time" placeholder="ç­”é¢˜æ—¶é—´(ç§’)" value="30">
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary" onclick="submitAnswer()">
                                    <i class="bi bi-check"></i> æäº¤ç­”æ¡ˆ
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex flex-wrap">
                        <button class="btn btn-info test-button" onclick="getStudentList()">è·å–å­¦ç”Ÿåˆ—è¡¨</button>
                        <button class="btn btn-secondary test-button" onclick="clearAllAnswers()">æ¸…é™¤æ‰€æœ‰ç­”æ¡ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡åˆ†æ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="api-section">
                    <h4><i class="bi bi-bar-chart"></i> ç»Ÿè®¡åˆ†æ</h4>
                    <div class="d-flex flex-wrap">
                        <button class="btn btn-info test-button" onclick="getAnswerStatistics()">è·å–ç­”é¢˜ç»Ÿè®¡</button>
                        <button class="btn btn-info test-button" onclick="getParticipationRate()">è·å–å‚ä¸ç‡</button>
                        <button class="btn btn-info test-button" onclick="getCorrectRate()">è·å–æ­£ç¡®ç‡</button>
                        <button class="btn btn-info test-button" onclick="getAverageTime()">è·å–å¹³å‡æ—¶é—´</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- APIå“åº”æ˜¾ç¤º -->
        <div class="row">
            <div class="col-12">
                <div class="api-section">
                    <h4><i class="bi bi-terminal"></i> APIå“åº”</h4>
                    <div class="response-display" id="api-response">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•API...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½å…¬å…±ç»„ä»¶å’Œè„šæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/common.js"></script>

    <script>
        // APIåŸºç¡€URL
        const API_BASE = '/api';

        // å…¨å±€å˜é‡
        let lastCreatedQuestionId = null;

        // æ˜¾ç¤ºAPIå“åº”
        function displayResponse(response, url, method = 'GET') {
            const responseDiv = document.getElementById('api-response');
            const timestamp = new Date().toLocaleTimeString();
            responseDiv.textContent = `[${timestamp}] ${method} ${url}\n\n${JSON.stringify(response, null, 2)}`;
        }

        // æ˜¾ç¤ºé”™è¯¯
        function displayError(error, url, method = 'GET') {
            const responseDiv = document.getElementById('api-response');
            const timestamp = new Date().toLocaleTimeString();
            responseDiv.textContent = `[${timestamp}] ERROR ${method} ${url}\n\n${error.message || error}`;
        }

        // ç”Ÿæˆåº§ä½ç½‘æ ¼
        function generateSeatGrid() {
            const seatGrid = document.getElementById('seat-grid');
            const rows = ['A', 'B', 'C', 'D'];
            const cols = [1, 2, 3, 4];

            seatGrid.innerHTML = '';

            rows.forEach(row => {
                cols.forEach(col => {
                    const seatId = `${row}${col}`;
                    const seatDiv = document.createElement('div');
                    seatDiv.className = 'seat seat-empty';
                    seatDiv.id = `seat-${seatId}`;
                    seatDiv.textContent = seatId;
                    seatGrid.appendChild(seatDiv);
                });
            });
        }

        // åˆ·æ–°åº§ä½çŠ¶æ€
        async function refreshSeats() {
            try {
                const response = await fetch(`${API_BASE}/interactive/students`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'è·å–å­¦ç”Ÿä¿¡æ¯å¤±è´¥');
                }

                const students = result.data || [];

                // é‡ç½®æ‰€æœ‰åº§ä½
                document.querySelectorAll('.seat').forEach(seat => {
                    seat.className = 'seat seat-empty';
                    seat.textContent = seat.id.replace('seat-', '');
                });

                // æ›´æ–°æœ‰å­¦ç”Ÿçš„åº§ä½
                students.forEach(student => {
                    if (student.studentName && student.status !== 'EMPTY') {
                        const seatElement = document.getElementById(`seat-${student.seatId}`);
                        if (seatElement) {
                            seatElement.className = `seat seat-occupied`;
                            seatElement.innerHTML = `<strong>${student.seatId}</strong><br><small>${student.studentName}</small>`;

                            // æ ¹æ®ç­”é¢˜çŠ¶æ€æ·»åŠ ä¸åŒçš„æ ·å¼
                            if (student.lastAnswer) {
                                seatElement.classList.add('seat-answered');
                                if (student.isCorrect === true) {
                                    seatElement.classList.add('seat-correct');
                                } else if (student.isCorrect === false) {
                                    seatElement.classList.add('seat-incorrect');
                                }
                            }
                        }
                    }
                });

                displayResponse(students, '/interactive/students');
            } catch (error) {
                displayError(error, '/interactive/students');
            }
        }

        // ä¼šè¯ç®¡ç†API
        async function createSession() {
            try {
                const name = document.getElementById('session-name').value;
                const description = document.getElementById('session-description').value;

                const response = await fetch(`${API_BASE}/interactive/sessions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description })
                });
                const result = await response.json();
                displayResponse(result, '/interactive/sessions', 'POST');
                updateSystemStatus();
            } catch (error) {
                displayError(error, '/interactive/sessions', 'POST');
            }
        }

        async function getCurrentSession() {
            try {
                const response = await fetch(`${API_BASE}/interactive/sessions/current`);
                const result = await response.json();
                displayResponse(result, '/interactive/sessions/current');
            } catch (error) {
                displayError(error, '/interactive/sessions/current');
            }
        }

        async function endSession() {
            try {
                const response = await fetch(`${API_BASE}/interactive/sessions/current`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                displayResponse(result, '/interactive/sessions/current', 'DELETE');
                updateSystemStatus();
            } catch (error) {
                displayError(error, '/interactive/sessions/current', 'DELETE');
            }
        }

        async function clearSessionData() {
            try {
                const response = await fetch(`${API_BASE}/interactive/sessions/clear`, {
                    method: 'POST'
                });
                const result = await response.json();
                displayResponse(result, '/interactive/sessions/clear', 'POST');
                refreshSeats();
            } catch (error) {
                displayError(error, '/interactive/sessions/clear', 'POST');
            }
        }

        // é¢˜ç›®ç®¡ç†API
        async function createQuestion() {
            try {
                const options = [
                    document.getElementById('option-a').value,
                    document.getElementById('option-b').value,
                    document.getElementById('option-c').value,
                    document.getElementById('option-d').value
                ];

                const correctAnswerIndex = document.getElementById('correct-answer').value;
                let correctAnswer;

                // å°†A,B,C,Dè½¬æ¢ä¸ºå®é™…çš„é€‰é¡¹å€¼
                switch(correctAnswerIndex.toUpperCase()) {
                    case 'A': correctAnswer = options[0]; break;
                    case 'B': correctAnswer = options[1]; break;
                    case 'C': correctAnswer = options[2]; break;
                    case 'D': correctAnswer = options[3]; break;
                    default: correctAnswer = correctAnswerIndex; // å¦‚æœç›´æ¥è¾“å…¥é€‰é¡¹å€¼
                }

                const questionData = {
                    content: document.getElementById('question-text').value,
                    options: options,
                    correctAnswer: correctAnswer,
                    timeLimit: parseInt(document.getElementById('time-limit').value) || 60
                };

                const response = await fetch(`${API_BASE}/interactive/questions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(questionData)
                });
                const result = await response.json();

                // ä¿å­˜åˆ›å»ºçš„é—®é¢˜ID
                if (result.success && result.data && result.data.id) {
                    lastCreatedQuestionId = result.data.id;
                }

                displayResponse(result, '/interactive/questions', 'POST');
            } catch (error) {
                displayError(error, '/interactive/questions', 'POST');
            }
        }

        async function publishQuestion() {
            try {
                const response = await fetch(`${API_BASE}/interactive/questions/publish`, {
                    method: 'POST'
                });
                const result = await response.json();
                displayResponse(result, '/interactive/questions/publish', 'POST');
            } catch (error) {
                displayError(error, '/interactive/questions/publish', 'POST');
            }
        }

        async function getCurrentQuestion() {
            try {
                const response = await fetch(`${API_BASE}/interactive/questions/current`);
                const result = await response.json();
                displayResponse(result, '/interactive/questions/current');
            } catch (error) {
                displayError(error, '/interactive/questions/current');
            }
        }

        async function stopQuestion() {
            try {
                const response = await fetch(`${API_BASE}/interactive/questions/stop`, {
                    method: 'POST'
                });
                const result = await response.json();
                displayResponse(result, '/interactive/questions/stop', 'POST');
            } catch (error) {
                displayError(error, '/interactive/questions/stop', 'POST');
            }
        }

        // å­¦ç”Ÿç®¡ç†API
        async function assignStudent() {
            try {
                const studentData = {
                    seatId: document.getElementById('seat-id').value,
                    studentName: document.getElementById('student-name').value
                };

                const response = await fetch(`${API_BASE}/interactive/students`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(studentData)
                });
                const result = await response.json();
                displayResponse(result, '/interactive/students', 'POST');
                refreshSeats();
            } catch (error) {
                displayError(error, '/interactive/students', 'POST');
            }
        }

        async function submitAnswer() {
            try {
                const seatId = document.getElementById('answer-seat-id').value;
                const answerData = {
                    answer: document.getElementById('answer-content').value
                };

                const response = await fetch(`${API_BASE}/interactive/students/${seatId}/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(answerData)
                });
                const result = await response.json();
                displayResponse(result, `/interactive/students/${seatId}/answer`, 'POST');
                refreshSeats();
            } catch (error) {
                displayError(error, `/interactive/students/${seatId}/answer`, 'POST');
            }
        }

        async function getStudentList() {
            try {
                const response = await fetch(`${API_BASE}/interactive/students`);
                const result = await response.json();
                displayResponse(result, '/interactive/students');
            } catch (error) {
                displayError(error, '/interactive/students');
            }
        }

        async function clearAllAnswers() {
            try {
                const response = await fetch(`${API_BASE}/interactive/students/clear-answers`, {
                    method: 'POST'
                });
                const result = await response.json();
                displayResponse(result, '/interactive/students/clear-answers', 'POST');
                refreshSeats();
            } catch (error) {
                displayError(error, '/interactive/students/clear-answers', 'POST');
            }
        }

        // ç»Ÿè®¡åˆ†æAPI
        async function getAnswerStatistics() {
            try {
                const response = await fetch(`${API_BASE}/interactive/statistics/answers`);
                const result = await response.json();
                displayResponse(result, '/interactive/statistics/answers');
            } catch (error) {
                displayError(error, '/interactive/statistics/answers');
            }
        }

        async function getParticipationRate() {
            try {
                const response = await fetch(`${API_BASE}/interactive/statistics/participation-rate`);
                const result = await response.json();
                displayResponse(result, '/interactive/statistics/participation-rate');
            } catch (error) {
                displayError(error, '/interactive/statistics/participation-rate');
            }
        }

        async function getCorrectRate() {
            try {
                const response = await fetch(`${API_BASE}/interactive/statistics/correct-rate`);
                const result = await response.json();
                displayResponse(result, '/interactive/statistics/correct-rate');
            } catch (error) {
                displayError(error, '/interactive/statistics/correct-rate');
            }
        }

        async function getAverageTime() {
            try {
                const response = await fetch(`${API_BASE}/interactive/statistics/average-time`);
                const result = await response.json();
                displayResponse(result, '/interactive/statistics/average-time');
            } catch (error) {
                displayError(error, '/interactive/statistics/average-time');
            }
        }

        // ä¸€é”®åˆ†é…16ä¸ªå­¦ç”Ÿåº§ä½
        async function assignAllStudents() {
            try {
                const studentNames = [
                    'å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é™ˆä¸ƒ', 'åˆ˜å…«', 'æ¨ä¹', 'é»„å',
                    'å‘¨å°æ˜', 'å´å°çº¢', 'å­™å°å', 'èƒ¡å°ä¸½', 'æœ±å°å¼º', 'é«˜å°ç¾', 'æ—å°åˆš', 'ç½—å°èŠ³'
                ];

                let successCount = 0;
                let failCount = 0;

                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        const seatId = String.fromCharCode(65 + row) + (col + 1); // A1, A2, ..., D4
                        const studentName = studentNames[row * 4 + col];

                        try {
                            const response = await fetch(`${API_BASE}/interactive/students`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    seatId: seatId,
                                    studentName: studentName
                                })
                            });

                            if (response.ok) {
                                successCount++;
                            } else {
                                failCount++;
                                console.error(`Failed to assign student to ${seatId}`);
                            }
                        } catch (error) {
                            failCount++;
                            console.error(`Error assigning student to ${seatId}:`, error);
                        }

                        // æ·»åŠ å°å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                }

                // æ˜¾ç¤ºç»“æœ
                const result = {
                    message: 'ä¸€é”®åˆ†é…å­¦ç”Ÿå®Œæˆ',
                    success: successCount,
                    failed: failCount,
                    total: 16
                };
                displayResponse(result, '/interactive/students/assign (æ‰¹é‡)', 'POST');

                // åˆ·æ–°åº§ä½çŠ¶æ€
                await refreshSeats();

            } catch (error) {
                displayError(error, '/interactive/students/assign (æ‰¹é‡)', 'POST');
            }
        }

        // ä¸€é”®æ¨¡æ‹Ÿæ‰€æœ‰å­¦ç”Ÿç­”é¢˜
        async function simulateAllAnswers() {
            try {
                // é¦–å…ˆè·å–å½“å‰é¢˜ç›®
                const questionResponse = await fetch(`${API_BASE}/interactive/questions/current`);
                const questionData = await questionResponse.json();

                if (!questionData.question) {
                    displayError(new Error('æ²¡æœ‰å½“å‰é¢˜ç›®ï¼Œè¯·å…ˆå‘å¸ƒä¸€ä¸ªé¢˜ç›®'), '/interactive/answers/submit (æ‰¹é‡)', 'POST');
                    return;
                }

                let successCount = 0;
                let failCount = 0;
                const answers = ['A', 'B', 'C', 'D'];

                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        const seatId = String.fromCharCode(65 + row) + (col + 1); // A1, A2, ..., D4
                        const randomAnswer = answers[Math.floor(Math.random() * answers.length)];

                        try {
                            const response = await fetch(`${API_BASE}/interactive/students/${seatId}/answer`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    answer: randomAnswer
                                })
                            });

                            if (response.ok) {
                                successCount++;
                            } else {
                                failCount++;
                                console.error(`Failed to submit answer for ${seatId}`);
                            }
                        } catch (error) {
                            failCount++;
                            console.error(`Error submitting answer for ${seatId}:`, error);
                        }

                        // æ·»åŠ å°å»¶è¿Ÿæ¨¡æ‹ŸçœŸå®ç­”é¢˜æ—¶é—´é—´éš”
                        await new Promise(resolve => setTimeout(resolve, 200));
                    }
                }

                // æ˜¾ç¤ºç»“æœ
                const result = {
                    message: 'ä¸€é”®æ¨¡æ‹Ÿç­”é¢˜å®Œæˆ',
                    questionId: questionData.question.id,
                    success: successCount,
                    failed: failCount,
                    total: 16
                };
                displayResponse(result, '/interactive/answers/submit (æ‰¹é‡)', 'POST');

                // åˆ·æ–°åº§ä½çŠ¶æ€
                await refreshSeats();

            } catch (error) {
                displayError(error, '/interactive/answers/submit (æ‰¹é‡)', 'POST');
            }
        }

        // æ›´æ–°ç³»ç»ŸçŠ¶æ€
        async function updateSystemStatus() {
            try {
                // è·å–å½“å‰ä¼šè¯
                const sessionResponse = await fetch(`${API_BASE}/interactive/sessions/current`);
                const sessionData = await sessionResponse.json();

                document.getElementById('current-session').innerHTML = sessionData.session ?
                    `<strong>${sessionData.session.name}</strong><br><small>${sessionData.session.description}</small>` :
                    '<span class="text-muted">æ— æ´»åŠ¨ä¼šè¯</span>';

                // è·å–è®¾å¤‡ç»Ÿè®¡
                const devicesResponse = await fetch(`${API_BASE}/devices`);
                const devicesResult = await devicesResponse.json();
                const devices = devicesResult.success ? devicesResult.data : [];
                const interactiveDevices = devices.filter(d => d.type.includes('INTERACTIVE'));

                document.getElementById('device-stats').innerHTML =
                    `äº’åŠ¨æ•™å­¦è®¾å¤‡: <strong>${interactiveDevices.length}</strong><br>` +
                    `<small>æ§åˆ¶å™¨: ${interactiveDevices.filter(d => d.type === 'INTERACTIVE_CONTROLLER').length}, ` +
                    `æ˜¾ç¤ºå™¨: ${interactiveDevices.filter(d => d.type === 'INTERACTIVE_DISPLAY').length}, ` +
                    `å­¦ç”Ÿç»ˆç«¯: ${interactiveDevices.filter(d => d.type === 'INTERACTIVE_STUDENT_TERMINAL').length}</small>`;

            } catch (error) {
                console.error('Failed to update system status:', error);
            }
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateSeatGrid();
            updateSystemStatus();
            refreshSeats();

            // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°åº§ä½çŠ¶æ€
            setInterval(() => {
                refreshSeats();
                updateSystemStatus();
            }, 10000);
        });
    </script>
</body>
</html>
